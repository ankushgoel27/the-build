<project name="Drupal" default="test">
    <!--
      Include this file in your build.xml with:
        <import file="vendor/palantirnet/the-build/tasks/drupal.xml" />
      -->

    <propertyprompt propertyName="build.env" defaultValue="vagrant" promptText="Environment" promptCharacter=":" useExistingValue="true"/>
    <property name="build.dir" value="${application.startdir}" />

    <property file="${build.dir}/conf/build.${build.env}.properties" />
    <property file="${build.dir}/conf/build.properties" />

    <!-- These properties will generally be set by a build properties file. -->
    <property name="build.project" value="drupal-skeleton" />
    <property name="drupal.root" value="web" />
    <property name="drupal.uri" value="http://${build.project}.local" />
    <property name="drupal.private_files_dir" value="${build.dir}/artifacts/private" />
    <property name="build.drupal.files" value="${build.dir}/artifacts/files" />

    <!-- These properties will generally not change. -->
    <property name="drupal.sites_dir" value="sites/default" />
    <property name="drupal.files_dir" value="sites/default/files" />
    <property name="build.drupal.settings" value="${build.dir}/conf/drupal/settings.php" />

    <!-- Configure Drush -->
    <taskdef name="drush" classname="Drush\Task" />
    <property name="drush.bin" value="${build.dir}/vendor/bin/drush" />
    <property name="drush.uri" refid="drupal.uri" />
    <property name="drush.root" refid="drupal.root" />
    <property name="drush.config" value="${application.startdir}/conf/drushrc.php" />

    <!-- Target: test -->
    <target name="test">
        <echo message="Hello World!" />
        <drush command="status" />
    </target>

    <!-- Target: drupal-prepare-filesystem -->
    <target name="drupal-prepare-filesystem" description="Prepare the filesystem for running Drupal.">
        <mkdir dir="${build.dir}/${drupal.root}/${drupal.sites_dir}" />
        <chmod file="${build.dir}/${drupal.root}/${drupal.sites_dir}" mode="777" />

        <delete file="${build.dir}/${drupal.root}/${drupal.sites_dir}/files" />
        <symlink target="${build.drupal.files}" link="${build.dir}/${drupal.root}/${drupal.files_dir}" />
    </target>

</project>
