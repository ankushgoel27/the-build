<project name="repotools" default="status">
    <!--
      Include this file in your build.xml with:
        <import file="vendor/palantirnet/the-build/tasks/repo-tools.xml" />
      -->

    <fail unless="build.dir" />
    

    <target name="status">
        <echo>Hello world.</echo>
    </target>


    <target name="repotools-init-repository">
        <fail unless="repo.dir" />
        <fail unless="repo.source" />

        <!-- If this directory exists and is NOT a git directory, remove it. -->
        <if>
            <and>
                <available file="${repo.dir}" type="dir" />
                <not><available file="${repo.dir}/.git" type="dir" /></not>
            </and>
            <then>
                <fail message="Directory ${repo.dir} exists but is not a git repository. Please remove it before continuing." />
            </then>
        </if>

        <!-- If there is no directory there, clone the repo. -->
        <if>
            <not><available file="${repo.dir}/.git" type="dir" /></not>
            <then>
                <echo>Cloning the repository from ${repo.source}</echo>
                <gitclone repository="${repo.source}" targetPath="${repo.dir}" />
            </then>
        </if>
    </target>


</project>
